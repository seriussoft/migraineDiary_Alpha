-- Update-Database -Script -SourceMigration: $InitialDatabase -TargetMigration: AddTablesForSymptom_Medication_Dosage_Ingredient_and_UnitOfMeasurement
/**************
 * Zero to latest script
 **************/

CREATE TABLE [dbo].[MigraineModels] (
    [ID] [uniqueidentifier] NOT NULL,
    [DateStarted] [datetime] NOT NULL,
    [LengthOfMigraine] [time](7) NOT NULL,
    [Severity] [int] NOT NULL,
    CONSTRAINT [PK_dbo.MigraineModels] PRIMARY KEY ([ID])
)
CREATE TABLE [dbo].[__MigrationHistory] (
    [MigrationId] [nvarchar](255) NOT NULL,
    [Model] [varbinary](max) NOT NULL,
    [ProductVersion] [nvarchar](32) NOT NULL,
    CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId])
)
BEGIN TRY
    EXEC sp_MS_marksystemobject 'dbo.__MigrationHistory'
END TRY
BEGIN CATCH
END CATCH
INSERT INTO [__MigrationHistory] ([MigrationId], [Model], [ProductVersion]) VALUES ('201301272035149_InitialCreate', 0x1F8B0800000000000400CD57C96EDB3010BD17E83F08BA477496431BC80912DB098CC24911B9B9D3D2C8214A918A4805F1B7F5D04FEA2F7468EDF41AD787DEECE1CCE36C6F86FAF3EBB77FFD9E70E70D32C5A4E8BBA75ECF754084326262DE77731D9F7C71AFAF3E7FF24751F2EE3C577AE7460F2D85EABB2F5AA79784A8F00512AABC8485995432D65E2813422349CE7ABDAFE4F4940042B888E538FE532E344B60F907FF0EA40821D539E513190157A51C4F8225AAF3401350290DA1EF4ED83CA34CC090D16C31791E788589EBDC7046D19D0078EC3AE9C5E50F0581CEA4980729D58CF2E922053C8F2957503A7F995EECEB7FEFCCF84FA81052239C1407C5EFD691616C23CC815E18B796F135A12D236AABA2F23758740428FA9EC91432BD7882B804180F5D8774ED886D589BB56C8C0F7DF73E6791EB3CE49CD319873A5364ABF9906A4C33CD3444158E114DB1BA1FC63246C7C41A89E8084801203DB05015D058E8F3B31D283E698ABB5A726C776DEA9C59751FDE9A1378D756ED0BAB00B4A58F4DDF5C5374BED7EDA1B54ED5D737342305CF2A3E920D84F427344D7132B4085A4A9CA060E7E024F83831920283846A0D3F6A6FEB9BB4CCE81CAC53BC1A3DBD6399D258693AA3A62483285951DB3BD9D57D76CE6D1A3625A82CCC6FABB2DD61E56D617A3BAB77186802422F6386DAB3AD93A2440842CA69B686EB03C9F3446C9A17DBAC3B546FC3740EF6C7EBD0BD8DD739F8185E49791BAD14EF8FD590BE0DD54857917C6215CDEE13B2D228D6A4B63B6F1B756D95FAF69AC21655FD9236BB17EC0A8F0A15D7C114BDB1C8702858280D896714BCE0950F38C3781B8509152C06A5A7F227E0630169FEC55ACF07AC4EA254C4FFEBFD990BF69A032600FD8A1964C7D8A5118AF49176E93F617576E9C148F62E65A66D8EB8495777C07E9BB4DC96BBB669C1048C7F263182C2E78E8A3A78E3AED2D327ED57B23F04C5E60D8479330B08CD4BB401AD74C6229655E631D8B647958A559809688A55A53719F62E0D351E87A0140E10D779A63C4795513283682C1E739DE6FA46294866BC33097DB2FDFEE5B3A2EBB3FF989A7FEA1821A09BCC34E6A3B8CD198F6ABFEFD634D50608D33EF780F2E50B1FBF1E106EBEA8911EA4D813A84CDF105210661E4C21493982A94711D037D8ECDBEE1C7633E6E3CB02FB2F512546636F3EDA88F96ABBFA0BBFAA4C26E70D0000, '5.0.0.net45')
ALTER TABLE [dbo].[MigraineModels] ADD [TimeStarted] [datetime] NOT NULL DEFAULT '1900-01-01T00:00:00.000'
ALTER TABLE [dbo].[MigraineModels] ADD [TimeEnded] [datetime] NOT NULL DEFAULT '1900-01-01T00:00:00.000'
DECLARE @var0 nvarchar(128)
SELECT @var0 = name
FROM sys.default_constraints
WHERE parent_object_id = object_id(N'dbo.MigraineModels')
AND col_name(parent_object_id, parent_column_id) = 'LengthOfMigraine';
IF @var0 IS NOT NULL
    EXECUTE('ALTER TABLE [dbo].[MigraineModels] DROP CONSTRAINT ' + @var0)
ALTER TABLE [dbo].[MigraineModels] DROP COLUMN [LengthOfMigraine]
INSERT INTO [__MigrationHistory] ([MigrationId], [Model], [ProductVersion]) VALUES ('201301272107348_AddTimeColumns', 0x1F8B0800000000000400CD57C96EDB3010BD17E83F08BA477496431BC80912DB098CC24911B9B9D3D2C8214A918A4805F1B7F5D04FEA2F7468EDF41AD787DEECE1CCE36C6F86FAF3EBB77FFD9E70E70D32C5A4E8BBA75ECF754084326262DE77731D9F7C71AFAF3E7FF24751F2EE3C577AE7460F2D85EABB2F5AA79784A8F00512AABC8485995432D65E2813422349CE7ABDAFE4F4940042B888E538FE532E344B60F907FF0EA40821D539E513190157A51C4F8225AAF3401350290DA1EF4ED83CA34CC090D16C31791E788589EBDC7046D19D0078EC3AE9C5E50F0581CEA4980729D58CF2E922053C8F2957503A7F995EECEB7FEFCCF84FA81052239C1407C5EFD691616C23CC815E18B796F135A12D236AABA2F23758740428FA9EC91432BD7882B804180F5D8774ED886D589BB56C8C0F7DF73E6791EB3CE49CD319873A5364ABF9906A4C33CD3444158E114DB1BA1FC63246C7C41A89E8084801203DB05015D058E8F3B31D283E698ABB5A726C776DEA9C59751FDE9A1378D756ED0BAB00B4A58F4DDF5C5374BED7EDA1B54ED5D737342305CF2A3E920D84F427344D7132B4085A4A9CA060E7E024F83831920283846A0D3F6A6FEB9BB4CCE81CAC53BC1A3DBD6399D258693AA3A62483285951DB3BD9D57D76CE6D1A3625A82CCC6FABB2DD61E56D617A3BAB77186802422F6386DAB3AD93A2440842CA69B686EB03C9F3446C9A17DBAC3B546FC3740EF6C7EBD0BD8DD739F8185E49791BAD14EF8FD590BE0DD54857917C6215CDEE13B2D228D6A4B63B6F1B756D95FAF69AC21655FD9236BB17EC0A8F0A15D7C114BDB1C8702858280D896714BCE0950F38C3781B8509152C06A5A7F227E0630169FEC55ACF07AC4EA254C4FFEBFD990BF69A032600FD8A1964C7D8A5118AF49176E93F617576E9C148F62E65A66D8EB8495777C07E9BB4DC96BBB669C1048C7F263182C2E78E8A3A78E3AED2D327ED57B23F04C5E60D8479330B08CD4BB401AD74C6229655E631D8B647958A559809688A55A53719F62E0D351E87A0140E10D779A63C4795513283682C1E739DE6FA46294866BC33097DB2FDFEE5B3A2EBB3FF989A7FEA1821A09BCC34E6A3B8CD198F6ABFEFD634D50608D33EF780F2E50B1FBF1E106EBEA8911EA4D813A84CDF105210661E4C21493982A94711D037D8ECDBEE1C7633E6E3CB02FB2F512546636F3EDA88F96ABBFA0BBFAA4C26E70D0000, '5.0.0.net45')
CREATE TABLE [dbo].[SymptomModels] (
    [ID] [int] NOT NULL,
    [Name] [nvarchar](max) NOT NULL,
    CONSTRAINT [PK_dbo.SymptomModels] PRIMARY KEY ([ID])
)
CREATE TABLE [dbo].[UnitOfMeasurementModels] (
    [ID] [int] NOT NULL,
    [Name] [nvarchar](max) NOT NULL,
    CONSTRAINT [PK_dbo.UnitOfMeasurementModels] PRIMARY KEY ([ID])
)
CREATE TABLE [dbo].[DosageModels] (
    [ID] [int] NOT NULL,
    [Quantity] [float] NOT NULL,
    [UnitOfMeasurementID] [int] NOT NULL,
    CONSTRAINT [PK_dbo.DosageModels] PRIMARY KEY ([ID])
)
CREATE TABLE [dbo].[IngredientModels] (
    [ID] [int] NOT NULL,
    [Name] [nvarchar](max) NOT NULL,
    [DosageID] [int],
    CONSTRAINT [PK_dbo.IngredientModels] PRIMARY KEY ([ID])
)
CREATE TABLE [dbo].[MedicationModels] (
    [ID] [int] NOT NULL,
    [Name] [nvarchar](max) NOT NULL,
    [DosageID] [int],
    [IntredientID] [int],
    CONSTRAINT [PK_dbo.MedicationModels] PRIMARY KEY ([ID])
)
ALTER TABLE [dbo].[DosageModels] ADD CONSTRAINT [FK_dbo.DosageModels_dbo.UnitOfMeasurementModels_UnitOfMeasurementID] FOREIGN KEY ([UnitOfMeasurementID]) REFERENCES [dbo].[UnitOfMeasurementModels] ([ID])
ALTER TABLE [dbo].[IngredientModels] ADD CONSTRAINT [FK_dbo.IngredientModels_dbo.DosageModels_DosageID] FOREIGN KEY ([DosageID]) REFERENCES [dbo].[DosageModels] ([ID])
ALTER TABLE [dbo].[MedicationModels] ADD CONSTRAINT [FK_dbo.MedicationModels_dbo.DosageModels_DosageID] FOREIGN KEY ([DosageID]) REFERENCES [dbo].[DosageModels] ([ID])
ALTER TABLE [dbo].[MedicationModels] ADD CONSTRAINT [FK_dbo.MedicationModels_dbo.IngredientModels_IntredientID] FOREIGN KEY ([IntredientID]) REFERENCES [dbo].[IngredientModels] ([ID])
INSERT INTO [__MigrationHistory] ([MigrationId], [Model], [ProductVersion]) VALUES ('201301272234271_AddTablesForSymptom_Medication_Dosage_Ingredient_and_UnitOfMeasurement', 0x1F8B0800000000000400CD57C96EDB3010BD17E83F08BA477496431BC80912DB098CC24911B9B9D3D2C8214A918A4805F1B7F5D04FEA2F7468EDF41AD787DEECE1CCE36C6F86FAF3EBB77FFD9E70E70D32C5A4E8BBA75ECF754084326262DE77731D9F7C71AFAF3E7FF24751F2EE3C577AE7460F2D85EABB2F5AA79784A8F00512AABC8485995432D65E2813422349CE7ABDAFE4F4940042B888E538FE532E344B60F907FF0EA40821D539E513190157A51C4F8225AAF3401350290DA1EF4ED83CA34CC090D16C31791E788589EBDC7046D19D0078EC3AE9C5E50F0581CEA4980729D58CF2E922053C8F2957503A7F995EECEB7FEFCCF84FA81052239C1407C5EFD691616C23CC815E18B796F135A12D236AABA2F23758740428FA9EC91432BD7882B804180F5D8774ED886D589BB56C8C0F7DF73E6791EB3CE49CD319873A5364ABF9906A4C33CD3444158E114DB1BA1FC63246C7C41A89E8084801203DB05015D058E8F3B31D283E698ABB5A726C776DEA9C59751FDE9A1378D756ED0BAB00B4A58F4DDF5C5374BED7EDA1B54ED5D737342305CF2A3E920D84F427344D7132B4085A4A9CA060E7E024F83831920283846A0D3F6A6FEB9BB4CCE81CAC53BC1A3DBD6399D258693AA3A62483285951DB3BD9D57D76CE6D1A3625A82CCC6FABB2DD61E56D617A3BAB77186802422F6386DAB3AD93A2440842CA69B686EB03C9F3446C9A17DBAC3B546FC3740EF6C7EBD0BD8DD739F8185E49791BAD14EF8FD590BE0DD54857917C6215CDEE13B2D228D6A4B63B6F1B756D95FAF69AC21655FD9236BB17EC0A8F0A15D7C114BDB1C8702858280D896714BCE0950F38C3781B8509152C06A5A7F227E0630169FEC55ACF07AC4EA254C4FFEBFD990BF69A032600FD8A1964C7D8A5118AF49176E93F617576E9C148F62E65A66D8EB8495777C07E9BB4DC96BBB669C1048C7F263182C2E78E8A3A78E3AED2D327ED57B23F04C5E60D8479330B08CD4BB401AD74C6229655E631D8B647958A559809688A55A53719F62E0D351E87A0140E10D779A63C4795513283682C1E739DE6FA46294866BC33097DB2FDFEE5B3A2EBB3FF989A7FEA1821A09BCC34E6A3B8CD198F6ABFEFD634D50608D33EF780F2E50B1FBF1E106EBEA8911EA4D813A84CDF105210661E4C21493982A94711D037D8ECDBEE1C7633E6E3CB02FB2F512546636F3EDA88F96ABBFA0BBFAA4C26E70D0000, '5.0.0.net45')
